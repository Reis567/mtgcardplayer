{% extends 'accounts/base.html' %}

{% block title %}Dashboard - MTG Commander{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #0f0f1a;
    }

    .container {
        max-width: 1400px;
        padding: 0 20px;
    }

    /* ===== NAVBAR ===== */
    .navbar {
        background: rgba(15, 15, 26, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .navbar-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .navbar-brand {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
    }

    .navbar-logo {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #e94560, #4ecdc4);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: #fff;
    }

    .navbar-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #fff;
    }

    .navbar-title span {
        color: #e94560;
    }

    .navbar-nav {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-link {
        padding: 10px 18px;
        border-radius: 10px;
        color: #888;
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 500;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-link:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
    }

    .nav-link.active {
        background: rgba(233, 69, 96, 0.15);
        color: #e94560;
    }

    .nav-link-icon {
        font-size: 1.1rem;
    }

    .navbar-user {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .user-avatar {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: #fff;
        font-size: 1.1rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .user-info {
        text-align: right;
    }

    .user-name {
        font-weight: 600;
        color: #fff;
        font-size: 0.95rem;
    }

    .user-stats {
        font-size: 0.8rem;
        color: #888;
    }

    .btn-logout {
        padding: 8px 15px;
        background: rgba(233, 69, 96, 0.15);
        border: 1px solid rgba(233, 69, 96, 0.3);
        border-radius: 8px;
        color: #e94560;
        text-decoration: none;
        font-size: 0.85rem;
        transition: all 0.2s;
    }

    .btn-logout:hover {
        background: rgba(233, 69, 96, 0.25);
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
        padding: 30px 0;
    }

    /* ===== WELCOME SECTION ===== */
    .welcome-section {
        margin-bottom: 30px;
    }

    .welcome-text h1 {
        font-size: 2rem;
        margin-bottom: 8px;
    }

    .welcome-text h1 span {
        background: linear-gradient(135deg, #e94560, #4ecdc4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .welcome-text p {
        color: #888;
        font-size: 1.05rem;
    }

    /* ===== WARNING BANNER ===== */
    .warning-banner {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.05));
        border: 1px solid rgba(255, 193, 7, 0.2);
        border-radius: 16px;
        padding: 20px 25px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .warning-icon {
        font-size: 2.5rem;
    }

    .warning-content {
        flex: 1;
    }

    .warning-content h3 {
        color: #ffc107;
        margin-bottom: 5px;
        font-size: 1.1rem;
    }

    .warning-content p {
        color: #999;
        margin: 0;
    }

    .btn-warning {
        padding: 12px 25px;
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: #000;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 193, 7, 0.3);
    }

    /* ===== STATS GRID ===== */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 18px;
        transition: all 0.3s;
    }

    .stat-card:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateY(-3px);
    }

    .stat-icon {
        width: 55px;
        height: 55px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
    }

    .stat-icon.red { background: rgba(233, 69, 96, 0.15); }
    .stat-icon.cyan { background: rgba(78, 205, 196, 0.15); }
    .stat-icon.purple { background: rgba(108, 92, 231, 0.15); }
    .stat-icon.yellow { background: rgba(255, 193, 7, 0.15); }
    .stat-icon.green { background: rgba(46, 204, 113, 0.15); }

    .stat-info {
        flex: 1;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #fff;
        line-height: 1;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #888;
        font-size: 0.9rem;
    }

    /* ===== DASHBOARD GRID ===== */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 25px;
    }

    @media (max-width: 1100px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    /* ===== SECTION CARD ===== */
    .section-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 20px;
        overflow: hidden;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 25px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .section-title {
        font-size: 1.15rem;
        font-weight: 600;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-badge {
        background: rgba(233, 69, 96, 0.2);
        color: #e94560;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .section-body {
        padding: 20px 25px;
    }

    /* ===== CREATE LOBBY ===== */
    .create-lobby-form {
        display: grid;
        grid-template-columns: 1fr 150px auto;
        gap: 15px;
        align-items: end;
    }

    @media (max-width: 768px) {
        .create-lobby-form {
            grid-template-columns: 1fr;
        }
    }

    .form-group {
        margin-bottom: 0;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #888;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input,
    .form-select {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-size: 1rem;
        transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
        outline: none;
        border-color: #e94560;
        background: rgba(0, 0, 0, 0.4);
    }

    .btn {
        padding: 14px 30px;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #e94560, #ff6b6b);
        color: #fff;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(233, 69, 96, 0.35);
    }

    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .btn-secondary {
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.12);
    }

    /* ===== LOBBIES LIST ===== */
    .lobbies-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .lobby-card {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        padding: 18px 20px;
        display: flex;
        align-items: center;
        gap: 20px;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }

    .lobby-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #4ecdc4, #45b7d1);
    }

    .lobby-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(78, 205, 196, 0.3);
        transform: translateX(5px);
    }

    .lobby-card.full {
        opacity: 0.6;
    }

    .lobby-card.full::before {
        background: linear-gradient(180deg, #ffc107, #ff9800);
    }

    .lobby-commanders {
        display: flex;
        gap: 5px;
    }

    .commander-mini {
        width: 40px;
        height: 56px;
        border-radius: 6px;
        object-fit: cover;
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .commander-placeholder {
        width: 40px;
        height: 56px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.05);
        border: 2px dashed rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
        font-size: 1.2rem;
    }

    .lobby-info {
        flex: 1;
    }

    .lobby-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #fff;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .lobby-status-badge {
        padding: 3px 10px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .lobby-status-badge.waiting {
        background: rgba(78, 205, 196, 0.2);
        color: #4ecdc4;
    }

    .lobby-status-badge.full {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }

    .lobby-meta {
        display: flex;
        align-items: center;
        gap: 15px;
        color: #888;
        font-size: 0.9rem;
    }

    .lobby-players-preview {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .player-avatar-mini {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 700;
        color: #fff;
        border: 2px solid #1a1a2e;
        margin-left: -8px;
    }

    .player-avatar-mini:first-child {
        margin-left: 0;
    }

    .empty-slot-mini {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        border: 2px dashed rgba(255, 255, 255, 0.2);
        margin-left: -8px;
    }

    .lobby-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
    }

    .btn-join {
        padding: 10px 25px;
        background: linear-gradient(135deg, #4ecdc4, #45b7d1);
        color: #fff;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s;
    }

    .btn-join:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(78, 205, 196, 0.35);
    }

    .btn-join.disabled {
        background: rgba(255, 255, 255, 0.1);
        color: #666;
        cursor: not-allowed;
        pointer-events: none;
    }

    .slots-text {
        font-size: 0.85rem;
        color: #888;
    }

    /* ===== EMPTY STATE ===== */
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: #666;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 15px;
        opacity: 0.3;
    }

    .empty-state h3 {
        color: #888;
        margin-bottom: 10px;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* ===== ONLINE PLAYERS ===== */
    .players-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .player-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 10px;
        transition: all 0.2s;
    }

    .player-item:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .player-avatar-sm {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: #fff;
        position: relative;
    }

    .online-dot {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 10px;
        height: 10px;
        background: #2ecc71;
        border-radius: 50%;
        border: 2px solid #1a1a2e;
    }

    .player-item-info {
        flex: 1;
    }

    .player-item-name {
        font-weight: 600;
        color: #fff;
        font-size: 0.95rem;
    }

    .player-item-stats {
        color: #888;
        font-size: 0.8rem;
    }

    /* ===== TOP COMMANDERS ===== */
    .commanders-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .commander-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 10px;
        transition: all 0.2s;
    }

    .commander-item:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .commander-img {
        width: 45px;
        height: 62px;
        border-radius: 6px;
        object-fit: cover;
    }

    .commander-item-info {
        flex: 1;
        min-width: 0;
    }

    .commander-item-name {
        font-weight: 600;
        color: #fff;
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .commander-item-count {
        color: #4ecdc4;
        font-size: 0.8rem;
    }

    /* ===== MY DECKS ===== */
    .decks-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .deck-card-mini {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        transition: all 0.2s;
    }

    .deck-card-mini:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(233, 69, 96, 0.3);
    }

    .deck-commander-img {
        width: 50px;
        height: 70px;
        border-radius: 6px;
        object-fit: cover;
        margin-bottom: 8px;
    }

    .deck-name-mini {
        font-size: 0.8rem;
        color: #fff;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* ===== QUICK TIPS ===== */
    .tips-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
        background: rgba(78, 205, 196, 0.05);
        border-radius: 10px;
        border-left: 3px solid #4ecdc4;
    }

    .tip-icon {
        font-size: 1.2rem;
    }

    .tip-text {
        color: #aaa;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    /* ===== RECENT GAMES ===== */
    .games-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .game-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 10px;
    }

    .game-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(46, 204, 113, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .game-info {
        flex: 1;
    }

    .game-winner {
        font-weight: 600;
        color: #2ecc71;
        font-size: 0.9rem;
    }

    .game-date {
        color: #666;
        font-size: 0.8rem;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
        .navbar-nav {
            display: none;
        }

        .welcome-text h1 {
            font-size: 1.5rem;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .warning-banner {
            flex-direction: column;
            text-align: center;
        }

        .lobby-card {
            flex-direction: column;
            align-items: flex-start;
        }

        .lobby-actions {
            width: 100%;
            flex-direction: row;
            justify-content: space-between;
        }
    }
</style>
{% endblock %}

{% block content %}
</div><!-- Close default container -->

<!-- NAVBAR -->
<nav class="navbar">
    <div class="navbar-content">
        <a href="/" class="navbar-brand">
            <div class="navbar-logo">M</div>
            <div class="navbar-title">MTG <span>Commander</span></div>
        </a>

        <div class="navbar-nav">
            <a href="/lobby/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="nav-link active">
                <span class="nav-link-icon">&#127968;</span> Dashboard
            </a>
            <a href="/cards/" class="nav-link">
                <span class="nav-link-icon">&#127183;</span> Cartas
            </a>
            <a href="/decks/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="nav-link">
                <span class="nav-link-icon">&#128451;</span> Decks
            </a>
        </div>

        <div class="navbar-user">
            <div class="user-info">
                <div class="user-name">{{ player.nickname }}</div>
                <div class="user-stats">{{ player.games_won }} vitoria{% if player.games_won != 1 %}s{% endif %}</div>
            </div>
            <div class="user-avatar" style="background-color: {{ player.avatar_color|default:'#e94560' }}">
                {{ player.nickname|slice:":1"|upper }}
            </div>
            <a href="/logout/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="btn-logout">Sair</a>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<main class="main-content">
    <div class="container">

        <!-- WELCOME -->
        <div class="welcome-section">
            <div class="welcome-text">
                <h1>Bem-vindo, <span>{{ player.nickname }}</span>!</h1>
                <p>Pronto para uma partida de Commander?</p>
            </div>
        </div>

        <!-- WARNING IF NO DECKS -->
        {% if not player_decks %}
        <div class="warning-banner">
            <span class="warning-icon">&#9888;&#65039;</span>
            <div class="warning-content">
                <h3>Voce precisa de um deck para jogar!</h3>
                <p>Importe um deck do Moxfield, Archidekt ou cole sua lista de cartas.</p>
            </div>
            <a href="/decks/import/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="btn-warning">Importar Deck</a>
        </div>
        {% endif %}

        <!-- STATS GRID -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon red">&#127918;</div>
                <div class="stat-info">
                    <div class="stat-value">{{ lobbies|length }}</div>
                    <div class="stat-label">Partidas Abertas</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon cyan">&#128101;</div>
                <div class="stat-info">
                    <div class="stat-value">{{ stats.players_online|default:"0" }}</div>
                    <div class="stat-label">Jogadores Online</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">&#128451;</div>
                <div class="stat-info">
                    <div class="stat-value">{{ stats.total_decks|default:"0" }}</div>
                    <div class="stat-label">Decks Disponiveis</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon yellow">&#127942;</div>
                <div class="stat-info">
                    <div class="stat-value">{{ stats.total_games|default:"0" }}</div>
                    <div class="stat-label">Partidas Jogadas</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">&#128640;</div>
                <div class="stat-info">
                    <div class="stat-value">{{ stats.lobbies_with_slots|default:"0" }}</div>
                    <div class="stat-label">Com Vagas</div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD GRID -->
        <div class="dashboard-grid">
            <!-- MAIN COLUMN -->
            <div class="main-column">
                <!-- CREATE LOBBY -->
                <div class="section-card" style="margin-bottom: 25px;">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#10133;</span> Criar Nova Partida
                        </h2>
                    </div>
                    <div class="section-body">
                        <form method="post" action="{% url 'lobby_create' %}" class="create-lobby-form">
                            {% csrf_token %}
                            {% if tab_id %}<input type="hidden" name="tab_id" value="{{ tab_id }}">{% endif %}
                            <div class="form-group">
                                <label>Nome da Partida</label>
                                <input type="text" name="name" class="form-input" placeholder="Ex: Partida casual, FFA competitivo...">
                            </div>
                            <div class="form-group">
                                <label>Jogadores</label>
                                <select name="max_players" class="form-select">
                                    <option value="2">2 (1v1)</option>
                                    <option value="3">3</option>
                                    <option value="4" selected>4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" {% if not player_decks %}disabled{% endif %}>
                                Criar Partida
                            </button>
                        </form>
                    </div>
                </div>

                <!-- LOBBIES LIST -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#127918;</span> Partidas Abertas
                        </h2>
                        <span class="section-badge">{{ lobbies|length }}</span>
                    </div>
                    <div class="section-body">
                        {% if lobbies %}
                        <div class="lobbies-list">
                            {% for lobby in lobbies %}
                            <div class="lobby-card {% if lobby.player_count >= lobby.max_players %}full{% endif %}">
                                <div class="lobby-commanders">
                                    {% for lp in lobby.players.all %}
                                        {% if lp.deck and lp.deck.commander.image_small %}
                                        <img src="{{ lp.deck.commander.image_small }}" alt="{{ lp.deck.commander.name }}" class="commander-mini" title="{{ lp.player.nickname }}: {{ lp.deck.commander.name }}">
                                        {% else %}
                                        <div class="commander-placeholder">?</div>
                                        {% endif %}
                                    {% endfor %}
                                    {% for i in "123456"|make_list %}
                                        {% if forloop.counter > lobby.players.count and forloop.counter <= lobby.max_players %}
                                        <div class="commander-placeholder">?</div>
                                        {% endif %}
                                    {% endfor %}
                                </div>

                                <div class="lobby-info">
                                    <div class="lobby-name">
                                        {{ lobby.name }}
                                        {% if lobby.player_count >= lobby.max_players %}
                                        <span class="lobby-status-badge full">Lotada</span>
                                        {% else %}
                                        <span class="lobby-status-badge waiting">Aguardando</span>
                                        {% endif %}
                                    </div>
                                    <div class="lobby-meta">
                                        <span>{{ lobby.max_players }} jogadores {% if lobby.max_players == 2 %}(1v1){% else %}(FFA){% endif %}</span>
                                        <div class="lobby-players-preview">
                                            {% for lp in lobby.players.all %}
                                            <div class="player-avatar-mini" style="background-color: {{ lp.player.avatar_color|default:'#e94560' }}" title="{{ lp.player.nickname }}">
                                                {{ lp.player.nickname|slice:":1"|upper }}
                                            </div>
                                            {% endfor %}
                                            {% for i in "123456"|make_list %}
                                                {% if forloop.counter > lobby.players.count and forloop.counter <= lobby.max_players %}
                                                <div class="empty-slot-mini"></div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>

                                <div class="lobby-actions">
                                    <span class="slots-text">{{ lobby.player_count }}/{{ lobby.max_players }}</span>
                                    {% if player_decks and lobby.player_count < lobby.max_players %}
                                    <a href="/lobby/{{ lobby.id }}/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="btn-join">Entrar</a>
                                    {% elif lobby.player_count >= lobby.max_players %}
                                    <span class="btn-join disabled">Lotada</span>
                                    {% else %}
                                    <span class="btn-join disabled">Sem Deck</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">&#128640;</div>
                            <h3>Nenhuma partida aberta</h3>
                            <p>Seja o primeiro a criar uma partida!</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <!-- ONLINE PLAYERS -->
                {% if online_players %}
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#128994;</span> Online Agora
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="players-list">
                            {% for p in online_players %}
                            <div class="player-item">
                                <div class="player-avatar-sm" style="background-color: {{ p.avatar_color|default:'#e94560' }}">
                                    {{ p.nickname|slice:":1"|upper }}
                                    <div class="online-dot"></div>
                                </div>
                                <div class="player-item-info">
                                    <div class="player-item-name">{{ p.nickname }}</div>
                                    <div class="player-item-stats">{{ p.games_won }} vitoria{% if p.games_won != 1 %}s{% endif %}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- TOP COMMANDERS -->
                {% if top_commanders %}
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#11088;</span> Top Commanders
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="commanders-list">
                            {% for cmd in top_commanders %}
                            <a href="/cards/card/{{ cmd.id }}/" class="commander-item" style="text-decoration: none;">
                                {% if cmd.image_small %}
                                <img src="{{ cmd.image_small }}" alt="{{ cmd.name }}" class="commander-img">
                                {% endif %}
                                <div class="commander-item-info">
                                    <div class="commander-item-name">{{ cmd.name }}</div>
                                    <div class="commander-item-count">{{ cmd.usage_count }} deck{% if cmd.usage_count > 1 %}s{% endif %}</div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- MY DECKS -->
                {% if player_decks %}
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#128451;</span> Decks Disponiveis
                        </h2>
                        <a href="/decks/{% if tab_id %}?tab={{ tab_id }}{% endif %}" class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">Ver Todos</a>
                    </div>
                    <div class="section-body">
                        <div class="decks-grid">
                            {% for deck in player_decks|slice:":4" %}
                            <div class="deck-card-mini">
                                {% if deck.commander.image_small %}
                                <img src="{{ deck.commander.image_small }}" alt="{{ deck.commander.name }}" class="deck-commander-img">
                                {% endif %}
                                <div class="deck-name-mini">{{ deck.name }}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- RECENT GAMES -->
                {% if recent_games %}
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#127942;</span> Partidas Recentes
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="games-list">
                            {% for game in recent_games %}
                            <div class="game-item">
                                <div class="game-icon">&#127942;</div>
                                <div class="game-info">
                                    <div class="game-winner">
                                        {% if game.winner %}
                                        {{ game.winner.player.nickname }} venceu!
                                        {% else %}
                                        Finalizada
                                        {% endif %}
                                    </div>
                                    <div class="game-date">{{ game.finished_at|date:"d/m H:i" }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- QUICK TIPS -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>&#128161;</span> Dicas
                        </h2>
                    </div>
                    <div class="section-body">
                        <div class="tips-list">
                            <div class="tip-item">
                                <span class="tip-icon">&#127183;</span>
                                <div class="tip-text">Importe decks do Moxfield ou Archidekt colando o link direto.</div>
                            </div>
                            <div class="tip-item">
                                <span class="tip-icon">&#128101;</span>
                                <div class="tip-text">Partidas de 4 jogadores sao o formato classico de Commander.</div>
                            </div>
                            <div class="tip-item">
                                <span class="tip-icon">&#9876;</span>
                                <div class="tip-text">Todos os jogadores precisam marcar "Pronto" para iniciar.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<div class="container" style="display: none;"><!-- Reopen for base template -->
{% endblock %}
